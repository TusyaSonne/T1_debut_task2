
<img width="1454" height="811" alt="–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ drawio (2)" src="https://github.com/user-attachments/assets/5a704037-975c-4d8b-9bbc-66f2d07c0226" />

# ‚öôÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
## –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
1. Gateway API ‚Äì –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —É Auth Service –∏ –ø–æ–ª—É—á–∞—è JWT, –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã.
2. Auth Service ‚Äì –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT + OAuth2).
3. User Service ‚Äì —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é.
4. Book Service ‚Äì –∫–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥: —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è.
5. Lending Service ‚Äì —É—á–µ—Ç –≤—ã–¥–∞—á–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–Ω–∏–≥, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –≤—ã–¥–∞—á–∏.
6. Delivery Service ‚Äì –ª–æ–≥–∏—Å—Ç–∏–∫–∞: –¥–æ—Å—Ç–∞–≤–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥.
7. Payment Service ‚Äì –±–µ–∑–Ω–∞–ª–∏—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —à—Ç—Ä–∞—Ñ–æ–≤: –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –¥–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø–æ—Ä—á–∏ (–∏–ª–∏ —É—Ç–µ—Ä–∏) –∫–Ω–∏–≥.
8. Notification Service ‚Äì –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (e-mail, push, SMS).

## –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
| –°–µ—Ä–≤–∏—Å               | –•—Ä–∞–Ω–∏–ª–∏—â–µ                  | –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏                                                   |
| -------------------- | -------------------------- | ------------------------------------------------------------- |
| User Service         | PostgreSQL                 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏                                                  |
| Book Service         | PostgreSQL / Elasticsearch | –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL, –ø–æ–∏—Å–∫ –ø–æ –∫–Ω–∏–≥–∞–º ‚Äî Elasticsearch |
| Lending Service      | PostgreSQL                 | –ò—Å—Ç–æ—Ä–∏—è –≤—ã–¥–∞—á                                                 |
| Notification Service | Redis                      | –û—á–µ—Ä–µ–¥–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π                                 |
| Delivery Service     | PostgreSQL                 | –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–Ω–∏–≥                                   |
| Payment Service      | PostgreSQL                 | –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–æ–≤, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏                               |

---
## –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–∏
| –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å     | –ü–æ–ª—É—á–∞—Ç–µ–ª—å      | –¢–∏–ø     | –°–æ–±—ã—Ç–∏–µ / –û–ø–µ—Ä–∞—Ü–∏—è                     |
| --------------- | --------------- | ------- | -------------------------------------- |
| API Gateway     | –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã (–∫—Ä–æ–º–µ Notification)    | REST    | –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å –∏–º–µ—é—â–∏–º—Å—è JWT)                |
| API Gateway     | Auth Service   | REST    | –ó–∞–ø—Ä–æ—Å –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                |
| Auth Service    | User Service    | REST    | –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è          |
| User Service    | Payment Service | REST    | –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–∑–∞ –Ω–µ—É–ø–ª–∞—á–µ–Ω–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã)                    |
| Lending Service | Book Catalog    | REST    | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–Ω–∏–≥–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏            |
| Lending Service | Delivery Service | Kafka   | `DeliveryRequestedEvent`, `ReturnRequestedEvent` - –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞             |
| Lending Service | Notification    | Kafka   | `BookIssuedEvent`, `BookReturnedEvent` - –∫–Ω–∏–≥–∞ –≤—ã–¥–∞–Ω–∞, –∫–Ω–∏–≥–∞ –ø—Ä–∏–Ω—è—Ç–∞ |
| Lending Service | Payment Service | Kafka   | `FineIssuedEvent` - –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–∑–∞ –ø–æ—Ä—á—É, –ø—Ä–æ—Å—Ä–æ—á–∫—É, —É—Ç–µ—Ä—é)                     |
| Payment Service | User Service    | Kafka   | `PaymentSuccessEvent` - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —à—Ç—Ä–∞—Ñ–∞               |
| Payment Service | Notification    | Kafka   | `PaymentResultEvent` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–ª–∞—Ç—ã                  |
| Delivery Service | Lending Service    | Kafka   | `BookReturnedEvent` - –∫–Ω–∏–≥–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞          |
| Delivery Service | Notification    | Kafka   | `DeliveryStatusChangedEvent` - —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏           |


# üìä –ù–∞–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫

## 1. –û–±—â–µ—Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ)

### API-Gateway
- `http_requests_total{status="5xx"}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –Ω–∞ —à–ª—é–∑–µ
- `request_duration_seconds{service="api-gateway"}` ‚Äî –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
- `jwt_validation_failures_total` ‚Äî —á–∏—Å–ª–æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö JWT

### Kafka (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏)
- `kafka_server_BrokerTopicMetrics_MessagesInPerSec` ‚Äî –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka
- `kafka_server_BrokerTopicMetrics_BytesInPerSec` ‚Äî –æ–±—ä–µ–º –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
- `kafka_consumer_lag{group="consumer-group"}` ‚Äî –ª–∞–≥ –∫–æ–Ω—Å—é–º–µ—Ä–æ–≤
- `dead_letter_queue_messages_total` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ–ø–∞–≤—à–∏–µ –≤ DLQ (Dead Letter Queue)

##  2. –ú–µ—Ç—Ä–∏–∫–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

### User Service
- `user_created_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `user_lookup_duration_seconds` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `failed_user_fetch_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Book Service (–∫–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥)
- `books_catalog_size` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–∏–≥ –≤ –±–∞–∑–µ
- `book_search_requests_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ–∏—Å–∫
- `book_update_duration_seconds` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∏

### Lending Service (–≤—ã–¥–∞—á–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥)
- `books_issued_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥
- `books_returned_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã—Ö –∫–Ω–∏–≥
- `overdue_books_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥
- `lending_request_duration_seconds` ‚Äî –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–¥–∞—á—É

### Delivery Service (–¥–æ—Å—Ç–∞–≤–∫–∞)
- `delivery_requests_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É
- `delivery_success_total` ‚Äî —É—Å–ø–µ—à–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏
- `delivery_failures_total` ‚Äî —Å–±–æ–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- `delivery_duration_seconds` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏

### Payment Service
- `payments_processed_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- `payment_failures_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- `average_payment_amount` ‚Äî —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
- `fine_payments_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–ª–∞—Ç —à—Ç—Ä–∞—Ñ–æ–≤

### Notification Service
- `notifications_sent_total` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `notification_failures_total` ‚Äî –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
- `notification_latency_seconds` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏–µ–º –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º

## 3. –ú–µ—Ç—Ä–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Auth Service)

- `auth_login_attempts_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- `auth_login_failures_total` ‚Äî –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
- `auth_token_issued_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–¥–∞–Ω–Ω—ã—Ö JWT
- `invalid_jwt_requests_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–º–∏/–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

## 4. –ú–µ—Ç—Ä–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

- `service_instance_count{service=...}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å–µ—Ä–≤–∏—Å–∞
- `cpu_usage{service=...}` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
- `memory_usage{service=...}` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- `request_rate{service=...}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É

## 5. –ú–µ—Ç—Ä–∏–∫–∏ –æ—à–∏–±–æ–∫

- `exceptions_total{exception=...}` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- `http_response_errors_total{status="4xx|5xx"}` ‚Äî HTTP-–æ—à–∏–±–∫–∏
- `timeout_errors_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

## 6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

- `active_users_total` ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –¥–µ–Ω—å/—á–∞—Å
- `top_requested_books` ‚Äî —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏
- `avg_book_issue_duration` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç –∑–∞–∫–∞–∑–∞ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è
- `repeat_borrow_rate` ‚Äî –¥–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
- `fine_rate` ‚Äî –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à—Ç—Ä–∞—Ñ–æ–≤ –∫ —á–∏—Å–ª—É –≤—ã–¥–∞—á

## üõ† –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                   |
|----------------|----------------------------------------------|
| **Prometheus** | –°–±–æ—Ä –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫                      |
| **Grafana**    | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: –≥—Ä–∞—Ñ–∏–∫–∏, –∞–ª–µ—Ä—Ç—ã, –¥–∞—à–±–æ—Ä–¥—ã      |
| **Jaeger**     | –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤             |
